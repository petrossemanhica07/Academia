<!doctype html>
<html lang="pt-BR" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Academia B√≠blica</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Source+Sans+Pro:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-gold: #D4AF37;
      --secondary-gold: #F59E0B;
      --dark-bg: #1a1a2e;
      --dark-surface: #16213e;
      --dark-text: #eaeaea;
      --transition-speed: 0.3s;
    }

    body { box-sizing: border-box; }
    * { font-family: 'Source Sans Pro', sans-serif; }
    .font-display { font-family: 'Playfair Display', serif; }
    
    /* Dark Mode Styles */
    .dark-mode {
      background-color: var(--dark-bg) !important;
      color: var(--dark-text) !important;
    }
    .dark-mode .bg-white { background-color: var(--dark-surface) !important; }
    .dark-mode .bg-amber-50 { background-color: var(--dark-bg) !important; }
    .dark-mode .text-amber-900 { color: var(--dark-text) !important; }
    .dark-mode .text-amber-700 { color: #ccc !important; }
    .dark-mode .text-amber-600 { color: #aaa !important; }
    .dark-mode .text-amber-800 { color: var(--dark-text) !important; }
    .dark-mode .border-amber-200 { border-color: #333 !important; }
    .dark-mode .bg-amber-100 { background-color: #2a2a4a !important; }
    .dark-mode .bg-gray-100 { background-color: #2a2a4a !important; }
    .dark-mode .text-gray-500 { color: #888 !important; }
    .dark-mode .text-gray-400 { color: #777 !important; }
    .dark-mode .shadow-lg { box-shadow: 0 10px 30px rgba(0,0,0,0.5) !important; }
    .dark-mode .shadow-md { box-shadow: 0 5px 15px rgba(0,0,0,0.4) !important; }
    
    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(212, 175, 55, 0.3); }
      50% { box-shadow: 0 0 40px rgba(212, 175, 55, 0.6); }
    }
    
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    
    @keyframes bounce-in {
      0% { transform: scale(0); opacity: 0; }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }
    
    @keyframes confetti {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }
    
    .animate-fade { animation: fadeIn 0.5s ease-out forwards; }
    .animate-slide { animation: slideIn 0.4s ease-out forwards; }
    .animate-bounce-in { animation: bounce-in 0.5s ease-out forwards; }
    .certificate-glow { animation: pulse-glow 3s ease-in-out infinite; }
    
    /* Loading Skeleton */
    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }
    .dark-mode .skeleton {
      background: linear-gradient(90deg, #2a2a4a 25%, #3a3a5a 50%, #2a2a4a 75%);
    }
    
    /* Confetti Animation */
    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      top: -10px;
      z-index: 9999;
      animation: confetti 3s ease-out forwards;
    }
    
    /* Navigation Items */
    .nav-item { transition: all var(--transition-speed) ease; }
    .nav-item:hover { transform: translateY(-2px); }
    .nav-item.active { transform: scale(1.05); }
    
    /* Card Hover Effects */
    .card-hover { transition: all var(--transition-speed) ease; }
    .card-hover:hover { transform: translateY(-4px); box-shadow: 0 12px 24px rgba(0,0,0,0.15); }
    
    /* Progress Ring */
    .progress-ring { transition: stroke-dashoffset 0.5s ease; }
    
    /* Lesson Cards */
    .lesson-card { animation: fadeIn 0.5s ease-out forwards; }
    .lesson-card:nth-child(2) { animation-delay: 0.1s; }
    .lesson-card:nth-child(3) { animation-delay: 0.2s; }
    .lesson-card:nth-child(4) { animation-delay: 0.3s; }
    
    /* Text Content */
    .text-content { line-height: 1.8; }
    .text-content p { margin-bottom: 1rem; }
    
    /* Quiz Options */
    .quiz-option { transition: all 0.2s ease; }
    .quiz-option:hover:not(.selected):not(.correct):not(.incorrect) { 
      transform: scale(1.02); 
      border-color: #D4AF37;
    }
    .quiz-option.selected { background: #FEF3C7; border-color: #D4AF37; }
    .quiz-option.correct { background: #D1FAE5; border-color: #059669; }
    .quiz-option.incorrect { background: #FEE2E2; border-color: #DC2626; }
    
    /* Certificate Border */
    .certificate-border {
      border: 3px solid #D4AF37;
      background: linear-gradient(135deg, #FFFBEB 0%, #FEF3C7 50%, #FFFBEB 100%);
    }
    
    /* Gold Text & Background */
    .gold-text { color: #B8860B; }
    .gold-bg { background-color: #D4AF37; }
    
    /* Scrollbar Styling */
    .scroll-container {
      scrollbar-width: thin;
      scrollbar-color: #D4AF37 #F5F5DC;
    }
    .scroll-container::-webkit-scrollbar { width: 6px; }
    .scroll-container::-webkit-scrollbar-track { background: #F5F5DC; }
    .scroll-container::-webkit-scrollbar-thumb { background: #D4AF37; border-radius: 3px; }
    
    /* Speaking Indicator */
    .speaking-indicator {
      display: flex;
      gap: 3px;
      align-items: center;
    }
    .speaking-bar {
      width: 4px;
      background: #D4AF37;
      border-radius: 2px;
      animation: speaking 0.5s ease-in-out infinite;
    }
    .speaking-bar:nth-child(1) { height: 8px; animation-delay: 0s; }
    .speaking-bar:nth-child(2) { height: 16px; animation-delay: 0.1s; }
    .speaking-bar:nth-child(3) { height: 12px; animation-delay: 0.2s; }
    .speaking-bar:nth-child(4) { height: 20px; animation-delay: 0.3s; }
    .speaking-bar:nth-child(5) { height: 10px; animation-delay: 0.4s; }
    
    @keyframes speaking {
      0%, 100% { transform: scaleY(1); }
      50% { transform: scaleY(0.5); }
    }
    
    /* Locked Overlay */
    .locked-overlay {
      background: linear-gradient(135deg, rgba(255, 251, 235, 0.95) 0%, rgba(254, 243, 199, 0.95) 100%);
    }
    
    /* Menu Super Styles */
    .menu-overlay {
      background-color: rgba(120, 53, 15, 0.2);
      backdrop-filter: blur(4px);
      transition: opacity var(--transition-speed) ease;
    }
    
    .menu-drawer {
      transform: translateX(100%);
      transition: transform var(--transition-speed) cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: -10px 0 30px rgba(0,0,0,0.1);
    }
    
    .menu-open .menu-overlay { opacity: 1; pointer-events: auto; }
    .menu-open .menu-drawer { transform: translateX(0); }
    .menu-closed .menu-overlay { opacity: 0; pointer-events: none; }
    
    .menu-item {
      border-left: 3px solid transparent;
      transition: all 0.2s;
    }
    .menu-item:hover {
      background-color: #FFFBEB;
      border-left-color: #D4AF37;
      padding-left: 1.5rem;
    }
    
    /* Chat Overlay Styles */
    .chat-overlay {
      position: fixed;
      inset: 0;
      z-index: 100;
      display: none;
      background: rgba(120, 53, 15, 0.4);
      backdrop-filter: blur(8px);
      transition: all 0.4s ease;
    }
    
    #chat-window {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      max-width: 450px;
      height: 100%;
      background: white;
      z-index: 101;
      display: flex;
      flex-direction: column;
      box-shadow: 20px 0 50px rgba(0,0,0,0.2);
      transform: translateX(-100%);
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .chat-active .chat-overlay { display: block; animation: fadeIn 0.3s forwards; }
    .chat-active #chat-window { transform: translateX(0); }
    
    .chat-bubble {
      padding: 12px 16px;
      border-radius: 18px;
      max-width: 85%;
      font-size: 15px;
      margin-bottom: 10px;
      line-height: 1.5;
    }
    .bubble-ia { background: #F3F4F6; color: #1F2937; align-self: flex-start; border-bottom-left-radius: 4px; }
    .bubble-user { background: #D4AF37; color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
    
    /* Search Bar Styles */
    .search-container {
      position: relative;
      transition: all var(--transition-speed) ease;
    }
    .search-container:focus-within {
      transform: scale(1.02);
    }
    .search-input {
      width: 100%;
      padding: 12px 16px 12px 44px;
      border: 2px solid #E5E7EB;
      border-radius: 12px;
      font-size: 14px;
      transition: all var(--transition-speed) ease;
    }
    .search-input:focus {
      outline: none;
      border-color: #D4AF37;
      box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
    }
    .search-icon {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      color: #9CA3AF;
    }
    
    /* Bookmark Button */
    .bookmark-btn {
      transition: all 0.2s ease;
    }
    .bookmark-btn:hover {
      transform: scale(1.1);
    }
    .bookmark-btn.bookmarked {
      color: #D4AF37;
    }
    
    /* Achievement Badge Animation */
    .achievement-unlock {
      animation: bounce-in 0.6s ease-out forwards;
    }
    
    /* Progress Bar Animation */
    .progress-fill {
      transition: width 0.8s ease-out;
    }
    
    /* Toast Notification */
    .toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: linear-gradient(135deg, #D4AF37 0%, #F59E0B 100%);
      color: white;
      padding: 12px 24px;
      border-radius: 50px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      z-index: 9999;
      opacity: 0;
      transition: all 0.4s ease;
    }
    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
    
    /* Loading Spinner */
    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid #F3F4F6;
      border-top-color: #D4AF37;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Dark Mode Toggle */
    .dark-mode-toggle {
      transition: all 0.3s ease;
    }
    .dark-mode-toggle:hover {
      transform: rotate(180deg);
    }
    /* Anima√ß√£o para a transi√ß√£o de idioma */
.lang-active {
  opacity: 1 !important;
  pointer-events: auto !important;
}

.lang-active #lang-content {
  transform: scale(1) !important;
}

@keyframes text-glitch {
  0% { transform: translate(0); }
  20% { transform: translate(-2px, 2px); }
  40% { transform: translate(-2px, -2px); }
  60% { transform: translate(2px, 2px); }
  80% { transform: translate(2px, -2px); }
  100% { transform: translate(0); }
}

.text-switch-anim {
  animation: text-glitch 0.3s cubic-bezier(.25, .46, .45, .94) both;
  color: #D4AF37;
}
  </style>
  <style>@view-transition { navigation: auto; }</style>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body class="h-full bg-amber-50 transition-colors duration-500">
  <div id="app" class="h-full w-full flex flex-col overflow-hidden">
    <!-- Header -->
    <header id="app-header" class="bg-gradient-to-r from-amber-100 to-orange-100 shadow-md px-4 py-3 flex items-center justify-between sticky top-0 z-30 transition-colors duration-500">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-full gold-bg flex items-center justify-center shadow-lg overflow-hidden border-2 border-white">
          <img src="icon.png" class="w-full h-full object-cover" alt="Logo">
        </div>
        <div>
          <h1 id="header-title" class="font-display text-xl font-bold text-amber-900 leading-tight transition-colors duration-500">Academia B√≠blica</h1>
          <p class="text-[10px] text-amber-700 uppercase tracking-wider font-semibold transition-colors duration-500">Conhecimento que transforma</p>
        </div>
      </div>
      
      <div class="flex items-center gap-3">
        <!-- Dark Mode Toggle -->
        <button onclick="toggleDarkMode()" class="dark-mode-toggle w-10 h-10 rounded-xl bg-white/50 hover:bg-white text-amber-900 flex items-center justify-center transition shadow-sm border border-amber-200/50" aria-label="Alternar modo escuro">
          <svg id="dark-mode-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
          </svg>
        </button>
        
        <button onclick="switchLanguage('index_en.html')" class="w-10 h-10 rounded-xl bg-white/50 hover:bg-white text-amber-900 flex items-center justify-center transition shadow-sm border border-amber-200/50 group relative" aria-label="Mudar Idioma">
  <svg class="w-6 h-6 group-hover:rotate-180 transition-transform duration-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
  </svg>
  <span class="absolute -bottom-8 bg-amber-900 text-white text-[10px] py-1 px-2 rounded opacity-0 group-hover:opacity-100 transition pointer-events-none whitespace-nowrap">
    Tsonga
  </span>
</button>
        <!-- Progress Indicator -->
        <div id="progress-indicator" class="flex items-center justify-center relative w-10 h-10">
          <svg class="w-full h-full transform -rotate-90">
            <circle cx="20" cy="20" r="16" stroke="#FDE68A" stroke-width="3" fill="none" /> 
            <circle id="progress-circle" class="progress-ring" cx="20" cy="20" r="16" stroke="#D4AF37" stroke-width="3" fill="none" stroke-linecap="round" stroke-dasharray="100" stroke-dashoffset="100" />
          </svg>
          <span id="progress-text" class="absolute text-[10px] font-bold text-amber-900 transition-colors duration-500">0%</span>
        </div>

        <!-- Menu Button -->
        <button onclick="toggleMenu()" class="w-10 h-10 rounded-xl bg-white/50 hover:bg-white text-amber-900 flex items-center justify-center transition shadow-sm border border-amber-200/50" aria-label="Menu">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
          </svg>
        </button>
      </div>
    </header>
    
    <!-- Super Menu -->
    <div id="super-menu" class="fixed inset-0 z-50 menu-closed flex justify-end overflow-hidden pointer-events-none">
      <div class="menu-overlay absolute inset-0" onclick="toggleMenu()"></div>
      
      <div class="menu-drawer relative w-4/5 max-w-sm h-full bg-white flex flex-col shadow-2xl transition-colors duration-500">
        <div class="bg-gradient-to-br from-amber-400 to-orange-500 p-6 text-white relative overflow-hidden">
          <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full transform translate-x-1/2 -translate-y-1/2"></div>
          <div class="absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full transform -translate-x-1/2 translate-y-1/2"></div>
          
          <button onclick="toggleMenu()" class="absolute top-4 right-4 p-2 bg-white/20 rounded-full hover:bg-white/30 transition">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>

          <div class="relative z-10 flex flex-col items-center mt-2">
            <div class="w-20 h-20 rounded-2xl bg-white p-1 shadow-xl mb-3 transform rotate-3">
              <img src="icon.png" class="w-full h-full object-cover rounded-xl" alt="App Icon">
            </div>
            <h2 class="font-display text-xl font-bold">Academia B√≠blica</h2>
            <p class="text-amber-100 text-sm">Vers√£o 2.0</p>
          </div>
        </div>

        <div class="flex-1 overflow-y-auto py-4 px-2 space-y-1">
          <button onclick="menuNavigate('home')" class="menu-item w-full flex items-center gap-4 p-3 text-amber-900 rounded-lg group">
            <span class="w-10 h-10 rounded-full bg-amber-50 text-amber-600 flex items-center justify-center group-hover:bg-amber-100 transition">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
              </svg>
            </span>
            <span class="font-medium">In√≠cio</span>
          </button>

          <button onclick="menuNavigate('bookmarks')" class="menu-item w-full flex items-center gap-4 p-3 text-amber-900 rounded-lg group">
            <span class="w-10 h-10 rounded-full bg-amber-50 text-amber-600 flex items-center justify-center group-hover:bg-amber-100 transition">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z" />
              </svg>
            </span>
            <span class="font-medium">Salvos</span>
          </button>

          <button onclick="menuNavigate('courses')" class="menu-item w-full flex items-center gap-4 p-3 text-amber-900 rounded-lg group">
            <span class="w-10 h-10 rounded-full bg-amber-50 text-amber-600 flex items-center justify-center group-hover:bg-amber-100 transition">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
              </svg>
            </span>
            <span class="font-medium">Meus Cursos</span>
          </button>

          <button onclick="menuNavigate('certificates')" class="menu-item w-full flex items-center gap-4 p-3 text-amber-900 rounded-lg group">
            <span class="w-10 h-10 rounded-full bg-amber-50 text-amber-600 flex items-center justify-center group-hover:bg-amber-100 transition">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </span>
            <span class="font-medium">Certificados</span>
          </button>
          
          <div class="border-t border-gray-100 my-2 mx-4"></div>

          <button onclick="menuNavigate('profile')" class="menu-item w-full flex items-center gap-4 p-3 text-amber-900 rounded-lg group">
            <span class="w-10 h-10 rounded-full bg-amber-50 text-amber-600 flex items-center justify-center group-hover:bg-amber-100 transition">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
            </span>
            <span class="font-medium">Meu Perfil</span>
          </button>

          <button onclick="showAbout()" class="menu-item w-full flex items-center gap-4 p-3 text-amber-900 rounded-lg group">
            <span class="w-10 h-10 rounded-full bg-amber-50 text-amber-600 flex items-center justify-center group-hover:bg-amber-100 transition">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </span>
            <span class="font-medium">Sobre</span>
          </button>
        </div>

        <div class="p-4 bg-amber-50 text-center text-xs text-amber-400 transition-colors duration-500">
          <p>¬© 2024 Academia B√≠blica</p>
        </div>
      </div>
    </div>
    
    <!-- Main Content -->
    <main id="main-content" class="flex-1 overflow-auto scroll-container">
     <div id="screen-auth" class="fixed inset-0 z-50 bg-amber-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md border border-amber-200">
        <div class="text-center mb-6">
            <div class="w-16 h-16 mx-auto rounded-full gold-bg flex items-center justify-center mb-3">
                <img src="icon.png" class="w-10 h-10 object-contain">
            </div>
            <h2 class="font-display text-2xl font-bold text-amber-900">Bem-vindo</h2>
            <p class="text-amber-600">Acesse sua conta para continuar</p>
        </div>

        <form id="login-form" onsubmit="handleLogin(event)" class="space-y-4">
            <input type="email" name="email" placeholder="Seu E-mail" required class="w-full p-3 rounded-xl border border-amber-200 focus:border-amber-500 outline-none">
            <input type="password" name="password" placeholder="Sua Senha" required class="w-full p-3 rounded-xl border border-amber-200 focus:border-amber-500 outline-none">
            <button type="submit" class="w-full py-3 gold-bg text-white rounded-xl font-bold shadow-lg">Entrar</button>
            <p class="text-center text-sm text-amber-700 cursor-pointer hover:underline" onclick="toggleAuthMode()">N√£o tem conta? Crie agora</p>
        </form>

        <form id="register-form" onsubmit="handleRegister(event)" class="space-y-4 hidden">
            <input type="text" name="name" placeholder="Nome Completo (para o certificado)" required class="w-full p-3 rounded-xl border border-amber-200 outline-none">
            <input type="email" name="email" placeholder="Seu E-mail" required class="w-full p-3 rounded-xl border border-amber-200 outline-none">
            <input type="password" name="password" placeholder="Crie uma Senha" required class="w-full p-3 rounded-xl border border-amber-200 outline-none">
            <button type="submit" class="w-full py-3 bg-amber-600 text-white rounded-xl font-bold shadow-lg">Criar Conta</button>
            <p class="text-center text-sm text-amber-700 cursor-pointer hover:underline" onclick="toggleAuthMode()">J√° tenho conta. Entrar.</p>
        </form>
    </div>
</div>
      <!-- Home Screen -->
      <div id="screen-home" class="screen p-4 animate-fade">
        <!-- Search Bar -->
        <div class="mb-6">
          <div class="search-container">
            <svg class="search-icon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
            <input type="text" class="search-input" placeholder="Buscar cursos, li√ß√µes ou vers√≠culos..." oninput="handleSearch(this.value)">
          </div>
          <div id="search-results" class="hidden mt-4 space-y-2"></div>
        </div>

        <!-- Welcome Card -->
        <div class="mb-8 relative rounded-2xl overflow-hidden shadow-xl group">
          <div class="relative h-56 w-full">
            <img src="imagem.png" 
                 class="w-full h-full object-cover transform group-hover:scale-105 transition duration-700 ease-out" 
                 alt="Imagem inspiracional">
            
            <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent"></div>
          </div>
          
          <div class="absolute bottom-0 left-0 p-6 w-full">
            <div class="inline-block px-3 py-1 mb-2 rounded-full bg-amber-500/20 backdrop-blur-sm border border-amber-400/30">
              <span class="text-[10px] font-bold text-amber-200 uppercase tracking-wider">Vers√≠culo di√°rio</span>
            </div>
            <h2 id="welcome-title" class="font-display text-2xl font-bold text-white mb-1 shadow-sm leading-tight transition-colors duration-500">Buscai o Senhor enquanto se pode achar, invocai-o enquanto est√° perto.</h2>
            <p class="text-amber-100/90 text-sm font-medium">Isa√≠as 55:6 </p>
          </div>
        </div>
        
        <!-- Stats Cards -->
        <div class="grid grid-cols-3 gap-3 mb-6">
          <div class="bg-white rounded-xl p-3 shadow-md text-center card-hover transition-colors duration-500">
            <div class="text-2xl font-bold gold-text" id="stat-total-courses">
              0
            </div>
            <div class="text-xs text-amber-700 transition-colors duration-500">
              Cursos
            </div>
          </div>

          <div class="bg-white rounded-xl p-3 shadow-md text-center card-hover transition-colors duration-500">
            <div class="text-2xl font-bold gold-text" id="stat-finished-courses">
              0
            </div>
            <div class="text-xs text-amber-700 transition-colors duration-500">
              Feito
            </div>
          </div>

          <div class="bg-white rounded-xl p-3 shadow-md text-center card-hover transition-colors duration-500">
            <div class="text-2xl font-bold gold-text" id="stat-certificates">
              0
            </div>
            <div class="text-xs text-amber-700 transition-colors duration-500">
              Certificados
            </div>
          </div>
        </div>
        
        <!-- Continue Learning -->
        <div class="bg-white rounded-2xl p-4 shadow-lg mb-6 card-hover cursor-pointer transition-colors duration-500" id="continue-card">
          <div class="flex items-center gap-4">
            <div class="w-16 h-16 rounded-xl bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center">
              <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /> 
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
            <div class="flex-1">
              <h3 class="font-semibold text-amber-900 transition-colors duration-500" id="continue-title">Continuar Aprendendo</h3>
              <p class="text-sm text-amber-600 transition-colors duration-500" id="continue-subtitle">Pr√≥xima li√ß√£o dispon√≠vel</p>
              <div class="mt-2 h-2 bg-amber-100 rounded-full overflow-hidden transition-colors duration-500">
                <div id="continue-progress" class="h-full gold-bg rounded-full progress-fill transition-all duration-500" style="width: 0%"></div>
              </div>
            </div>
            <svg class="w-6 h-6 text-amber-400" fill="none" stroke="currentColor" viewbox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="grid grid-cols-2 gap-3">
          <button onclick="showScreen('courses')" class="bg-white rounded-xl p-4 shadow-md card-hover text-left transition-colors duration-500">
            <div class="w-10 h-10 rounded-lg bg-amber-100 flex items-center justify-center mb-2">
              <svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
              </svg>
            </div>
            <h4 class="font-semibold text-amber-900 text-sm transition-colors duration-500">Cursos</h4>
            <p class="text-xs text-amber-600 transition-colors duration-500">Ver todos os cursos</p>
          </button>
          
          <button onclick="showScreen('certificates')" class="bg-white rounded-xl p-4 shadow-md card-hover text-left transition-colors duration-500">
            <div class="w-10 h-10 rounded-lg bg-orange-100 flex items-center justify-center mb-2">
              <svg class="w-5 h-5 text-orange-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
              </svg>
            </div>
            <h4 class="font-semibold text-amber-900 text-sm transition-colors duration-500">Certificados</h4>
            <p class="text-xs text-amber-600 transition-colors duration-500">Suas conquistas</p>
          </button>
        </div>
      </div>
      
      <!-- Bookmarks Screen -->
      <div id="screen-bookmarks" class="screen p-4 hidden">
        <h2 class="font-display text-2xl font-bold text-amber-900 mb-4 transition-colors duration-500">Li√ß√µes Salvas</h2>
        <div id="bookmarks-list" class="space-y-4">
          <div class="text-center py-12">
            <div class="w-20 h-20 mx-auto rounded-full bg-amber-100 flex items-center justify-center mb-4">
              <svg class="w-10 h-10 text-amber-400" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z" />
              </svg>
            </div>
            <h3 class="font-semibold text-amber-800 mb-2 transition-colors duration-500">Nenhuma li√ß√£o salva</h3>
            <p class="text-sm text-amber-600 transition-colors duration-500">Salve li√ß√µes para acess√°-las rapidamente!</p>
          </div>
        </div>
      </div>
      
      <!-- Chat Wrapper -->
      <div id="chat-wrapper" class="">
        <div class="chat-overlay" onclick="toggleChat()"></div>

        <div id="chat-window">
          <div class="bg-gradient-to-r from-[#78350f] to-[#451a03] p-6 text-white flex items-center justify-between shadow-lg border-b border-amber-900/50">
            <div class="flex items-center gap-4">
              <div class="w-14 h-14 bg-white rounded-2xl flex items-center justify-center shadow-[0_0_15px_rgba(251,191,36,0.4)] border-2 border-amber-200 overflow-hidden transform -rotate-2">
                <img src="icon.png" class="w-full h-full object-cover" alt="Mentor Icon">
              </div>
              
              <div>
                <h3 class="font-display font-bold text-xl tracking-tight text-white">Academia B√≠blica</h3>
                <div class="flex flex-col">
                   <span class="text-[11px] text-amber-200/80 font-medium leading-none mb-1">Intelig√™ncia Artificial</span>
                   <div class="flex items-center gap-1.5">
                     <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse shadow-[0_0_5px_#22c55e]"></span>
                     <p class="text-[10px] text-green-400 uppercase tracking-widest font-bold">online</p>
                   </div>
                </div>
              </div>
            </div>

            <button onclick="toggleChat()" class="p-2 hover:bg-white/10 rounded-full transition-colors text-amber-200">
              <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M6 18L18 6M6 6l12 12" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>

          <div id="chat-messages" class="flex-1 overflow-y-auto p-6 flex flex-col bg-[#fafaf9]">
            <div class="chat-bubble bubble-ia shadow-sm">
              Paz seja convosco! Sou o seu Mentor de IA. Em que ponto da sua jornada de f√© posso ajudar hoje?
            </div>
          </div>

          <div class="p-4 bg-white border-t border-gray-100 pb-8">
            <div class="flex gap-3 items-center bg-gray-50 rounded-2xl px-4 py-3 border border-gray-200 focus-within:border-amber-400 focus-within:ring-1 focus-within:ring-amber-400 transition-all">
              <input id="chat-input" type="text" placeholder="Pergunte sobre um vers√≠culo ou tema..." class="bg-transparent border-none focus:outline-none text-sm flex-1 text-gray-800">
              <button onclick="sendChatMessage()" class="w-10 h-10 bg-amber-600 text-white rounded-xl flex items-center justify-center hover:bg-amber-700 transition shadow-md">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"/>
                </svg>
              </button>
            </div>
          </div>
        </div>

        <button onclick="toggleChat()" class="fixed bottom-6 right-6 w-16 h-16 bg-amber-600 rounded-full shadow-[0_10px 25px_rgba(180,83,9,0.4)] flex items-center justify-center text-white hover:scale-110 transition-transform active:scale-95 z-50 border-2 border-white/30 backdrop-blur-sm">
          <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
          </svg>
        </button>
      </div>
      
      <!-- Courses Screen -->
      <div id="screen-courses" class="screen p-4 hidden">
        <h2 class="font-display text-2xl font-bold text-amber-900 mb-4 transition-colors duration-500">Cursos Dispon√≠veis</h2>
        <div id="courses-list" class="space-y-4">
          <!-- Courses will be rendered here -->
        </div>
      </div>
      
      <!-- Lesson Screen -->
      <div id="screen-lesson" class="screen hidden">
        <div id="lesson-header-bg" class="relative bg-gray-900 p-6 text-white bg-cover bg-center transition-all duration-500">
          <div class="absolute inset-0 bg-black/60"></div>

          <div class="relative z-10 flex justify-between items-start">
            <div>
              <button onclick="showScreen('courses')" class="flex items-center gap-2 mb-4 opacity-80 hover:opacity-100 transition">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
                <span>Voltar</span> 
              </button>
              <h2 id="lesson-title" class="font-display text-2xl font-bold mb-2 shadow-sm">T√≠tulo da Li√ß√£o</h2>
              <p id="lesson-subtitle" class="opacity-90 font-medium">Descri√ß√£o da li√ß√£o</p>
            </div>
            
            <!-- Bookmark Button -->
            <button id="bookmark-btn" onclick="toggleBookmark()" class="bookmark-btn w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center text-white hover:bg-white/30 transition">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z" />
              </svg>
            </button>
          </div>
        </div>
        
        <div class="p-4">
          <!-- Lesson Tabs -->
          <div class="flex gap-2 mb-4 overflow-x-auto pb-2">
            <button onclick="showLessonTab('content')" class="lesson-tab px-4 py-2 rounded-full text-sm font-medium bg-amber-100 text-amber-800 whitespace-nowrap" data-tab="content"> 
              üìñ Conte√∫do 
            </button> 
            <button onclick="showLessonTab('audio')" class="lesson-tab px-4 py-2 rounded-full text-sm font-medium bg-gray-100 text-gray-600 whitespace-nowrap" data-tab="audio"> 
              üéß √Åudio 
            </button> 
            <button onclick="showLessonTab('quiz')" class="lesson-tab px-4 py-2 rounded-full text-sm font-medium bg-gray-100 text-gray-600 whitespace-nowrap" data-tab="quiz"> 
              ‚úèÔ∏è Avalia√ß√£o 
            </button>
          </div>
          
          <!-- Content Tab -->
          <div id="tab-content" class="lesson-content animate-fade">
            <div id="lesson-text" class="text-content text-amber-900 bg-white rounded-xl p-4 shadow-md transition-colors duration-500">
              <!-- Lesson content here -->
            </div>
            <div class="mt-4 p-4 bg-amber-50 rounded-xl border-l-4 border-amber-400 transition-colors duration-500">
              <p class="text-sm text-amber-800 italic transition-colors duration-500" id="lesson-verse">"Vers√≠culo de refer√™ncia"</p>
              <p class="text-xs text-amber-600 mt-1 transition-colors duration-500" id="lesson-reference">- Refer√™ncia</p>
            </div>
            <button onclick="showLessonTab('quiz')" class="w-full mt-4 py-3 gold-bg text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition"> Ir para Avalia√ß√£o ‚Üí </button>
          </div>
          
          <!-- Audio Tab -->
          <div id="tab-audio" class="lesson-content hidden">
            <div class="bg-white rounded-xl p-6 shadow-md text-center transition-colors duration-500">
              <div class="w-24 h-24 mx-auto rounded-full bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center mb-4 shadow-lg">
                <div id="audio-icon">
                  <svg class="w-12 h-12 text-white" fill="currentColor" viewbox="0 0 24 24">
                    <path d="M8 5v14l11-7z" />
                  </svg>
                </div>
                <div id="speaking-indicator" class="speaking-indicator hidden">
                  <div class="speaking-bar"></div>
                  <div class="speaking-bar"></div>
                  <div class="speaking-bar"></div>
                  <div class="speaking-bar"></div>
                  <div class="speaking-bar"></div>
                </div>
              </div>
              <h3 class="font-display text-xl font-bold text-amber-900 mb-2 transition-colors duration-500">Ouvir Li√ß√£o</h3>
              <p class="text-amber-600 text-sm mb-4 transition-colors duration-500">Escute o conte√∫do sendo narrado</p>
              <button id="audio-btn" onclick="toggleAudio()" class="px-6 py-3 gold-bg text-white rounded-full font-semibold shadow-md hover:shadow-lg transition"> ‚ñ∂Ô∏è Reproduzir </button>
              <p id="audio-status" class="text-xs text-amber-500 mt-3 transition-colors duration-500">Usando s√≠ntese de voz do navegador</p>
            </div>
          </div>
          
          <!-- Quiz Tab -->
          <div id="tab-quiz" class="lesson-content hidden">
            <div id="quiz-container">
              <!-- Quiz questions here -->
            </div>
            <div id="quiz-result" class="hidden text-center py-8">
              <div id="result-icon" class="w-20 h-20 mx-auto rounded-full flex items-center justify-center mb-4"></div>
              <h3 id="result-title" class="font-display text-2xl font-bold mb-2"></h3>
              <p id="result-message" class="text-amber-700 mb-4 transition-colors duration-500"></p>
              <p class="text-3xl font-bold gold-text mb-6" id="result-score">0%</p>
              <div class="flex gap-3 justify-center">
                <button onclick="retakeQuiz()" class="px-6 py-3 bg-amber-100 text-amber-800 rounded-xl font-semibold"> Refazer </button> 
                <button onclick="completeLesson()" class="px-6 py-3 gold-bg text-white rounded-xl font-semibold shadow-lg"> Concluir </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Certificates Screen -->
      <div id="screen-certificates" class="screen p-4 hidden">
        <h2 class="font-display text-2xl font-bold text-amber-900 mb-4 transition-colors duration-500">Meus Certificados</h2>
        <div id="certificates-list" class="space-y-4">
          <div id="no-certificates" class="text-center py-12">
            <div class="w-20 h-20 mx-auto rounded-full bg-amber-100 flex items-center justify-center mb-4">
              <svg class="w-10 h-10 text-amber-400" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
              </svg>
            </div>
            <h3 class="font-semibold text-amber-800 mb-2 transition-colors duration-500">Nenhum certificado ainda</h3>
            <p class="text-sm text-amber-600 transition-colors duration-500">Complete os cursos para ganhar certificados!</p>
          </div>
        </div>
      </div>
      
      <!-- Certificate View -->
      <div id="screen-certificate-view" class="screen p-4 hidden">
        <button onclick="showScreen('certificates')" class="flex items-center gap-2 mb-4 text-amber-700 transition-colors duration-500">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
          <span>Voltar</span> 
        </button>
        <div id="certificate-display" class="certificate-border rounded-2xl p-6 shadow-2xl certificate-glow">
          <!-- Certificate content here -->
        </div>
      </div>
      
      <!-- Profile Screen -->
    <div id="screen-profile" class="screen p-4 hidden">
    <div class="bg-white rounded-xl p-6 shadow-md mb-6">
        <form id="profile-edit-form" onsubmit="event.preventDefault(); saveProfile();">
            <div class="text-center mb-6 relative">
                <div class="w-24 h-24 mx-auto rounded-full overflow-hidden border-4 border-amber-200 relative group">
                    <img src="icon.png" class="profile-img-display w-full h-full object-cover">
                    
                    <div class="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition cursor-pointer">
                        <span class="text-white text-xs">Alterar</span>
                    </div>
                    <input type="file" name="profile_pic" class="absolute inset-0 opacity-0 cursor-pointer" accept="image/*">
                </div>
            </div>

            <div class="space-y-3">
                <div>
                    <label class="text-xs text-amber-700 font-bold">Nome Completo (Para Certificado)</label>
                    <input id="edit-name" name="full_name" type="text" class="w-full p-2 border rounded-lg text-sm bg-gray-50">
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="text-xs text-amber-700 font-bold">Telefone</label>
                        <input id="edit-phone" name="phone" type="text" class="w-full p-2 border rounded-lg text-sm bg-gray-50">
                    </div>
                    <div>
                        <label class="text-xs text-amber-700 font-bold">BI / ID</label>
                        <input id="edit-bi" name="bi" type="text" class="w-full p-2 border rounded-lg text-sm bg-gray-50">
                    </div>
                </div>
                <div>
                    <label class="text-xs text-amber-700 font-bold">Endere√ßo</label>
                    <input id="edit-address" name="address" type="text" class="w-full p-2 border rounded-lg text-sm bg-gray-50">
                </div>
                
                <button type="submit" class="w-full mt-4 py-2 gold-bg text-white rounded-lg font-bold shadow-sm">Salvar Altera√ß√µes</button>
            </div>
        </form>
    </div>
    
    <button onclick="logout()" class="w-full py-2 bg-red-100 text-red-700 rounded-lg text-sm font-bold">Sair da Conta</button>

        
        <div class="bg-white rounded-xl p-4 shadow-md mb-4 transition-colors duration-500">
          <h3 class="font-semibold text-amber-900 mb-3 transition-colors duration-500">Estat√≠sticas</h3>
          <div class="space-y-3">
            <div class="flex justify-between items-center">
              <span class="text-amber-700 transition-colors duration-500">Li√ß√µes Completadas</span> 
              <span class="font-bold gold-text" id="profile-lessons">0</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-amber-700 transition-colors duration-500">M√©dia nas Avalia√ß√µes</span> 
              <span class="font-bold gold-text" id="profile-average">0%</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-amber-700 transition-colors duration-500">Certificados Obtidos</span> 
              <span class="font-bold gold-text" id="profile-certs">0</span>
            </div>
          </div>
        </div>
        
        <div class="bg-white rounded-xl p-4 shadow-md transition-colors duration-500">
          <h3 class="font-semibold text-amber-900 mb-3 transition-colors duration-500">Conquistas</h3>
          <div id="achievements" class="grid grid-cols-4 gap-3">
            <div class="text-center">
              <div class="w-12 h-12 mx-auto rounded-full bg-amber-100 flex items-center justify-center text-2xl opacity-30 transition-all duration-500">üåü</div>
              <p class="text-xs text-amber-600 mt-1 transition-colors duration-500">Iniciante</p>
            </div>
            <div class="text-center">
              <div class="w-12 h-12 mx-auto rounded-full bg-amber-100 flex items-center justify-center text-2xl opacity-30 transition-all duration-500">üìö</div>
              <p class="text-xs text-amber-600 mt-1 transition-colors duration-500">Estudioso</p>
            </div>
            <div class="text-center">
              <div class="w-12 h-12 mx-auto rounded-full bg-amber-100 flex items-center justify-center text-2xl opacity-30 transition-all duration-500">üèÜ</div>
              <p class="text-xs text-amber-600 mt-1 transition-colors duration-500">Campe√£o</p>
            </div>
            <div class="text-center">
              <div class="w-12 h-12 mx-auto rounded-full bg-amber-100 flex items-center justify-center text-2xl opacity-30 transition-all duration-500">üëë</div>
              <p class="text-xs text-amber-600 mt-1 transition-colors duration-500">Mestre</p>
            </div>
          </div>
        </div>
      </div>
    </main>
    
    
    <!-- Bottom Navigation -->
    <nav class="bg-white shadow-lg border-t border-amber-100 px-4 py-2 transition-colors duration-500">
      <div class="flex justify-around">
        <button onclick="showScreen('home')" class="nav-item flex flex-col items-center py-2 px-4 rounded-xl active" data-screen="home">
          <svg class="w-6 h-6 text-amber-500" fill="currentColor" viewbox="0 0 24 24">
            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
          </svg>
          <span class="text-xs mt-1 text-amber-700 font-medium transition-colors duration-500">In√≠cio</span> 
        </button> 
        <button onclick="showScreen('courses')" class="nav-item flex flex-col items-center py-2 px-4 rounded-xl" data-screen="courses">
          <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewbox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
          </svg>
          <span class="text-xs mt-1 text-gray-500 transition-colors duration-500">Cursos</span> 
        </button> 
        <button onclick="showScreen('certificates')" class="nav-item flex flex-col items-center py-2 px-4 rounded-xl" data-screen="certificates">
          <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewbox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
          </svg>
          <span class="text-xs mt-1 text-gray-500 transition-colors duration-500">Certificados</span> 
        </button> 
        <button onclick="showScreen('profile')" class="nav-item flex flex-col items-center py-2 px-4 rounded-xl" data-screen="profile">
          <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewbox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          </svg>
          <span class="text-xs mt-1 text-gray-500 transition-colors duration-500">Perfil</span> 
        </button>
      </div>
    </nav>
  </div>
  <div id="lang-transition-overlay" class="fixed inset-0 z-[9999] pointer-events-none opacity-0 flex flex-col items-center justify-center transition-all duration-700 backdrop-blur-sm">
  <div class="absolute inset-0 bg-amber-50/90 dark:bg-[#1a1a2e]/95 transition-colors duration-500"></div>
  
  <div class="relative z-10 text-center transform scale-90 transition-transform duration-700" id="lang-content">
    <div class="w-24 h-24 mx-auto mb-6 relative">
      <div class="absolute inset-0 border-4 border-amber-200 rounded-full animate-[spin_3s_linear_infinite]"></div>
      <div class="absolute inset-0 border-t-4 border-amber-500 rounded-full animate-[spin_1s_linear_infinite]"></div>
      
      <div class="absolute inset-0 flex items-center justify-center">
        <svg class="w-10 h-10 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
        </svg>
      </div>
    </div>
    
    <h2 id="lang-text" class="font-display text-3xl font-bold text-amber-900 mb-2">Traduzindo...</h2>
    <p class="text-amber-600 text-sm tracking-widest uppercase">To Tsonga</p>
  </div>
</div>
  <script>
  // Initialize App
  document.addEventListener('DOMContentLoaded', () => {
    initApp();
  });
  
   currentUser = null; // Vari√°vel global para dados do usu√°rio

  function initApp() {
    // Load saved preferences
    checkSession(); 
    loadDarkModePreference();
    loadBookmarks();
    updateUI();
    renderCourses();
    
    // Initialize Element SDK if available
    if (window.elementSdk) {
      window.elementSdk.addHandler(elementHandler);
    }
    
    // Initialize Data SDK if available
    if (window.dataSdk) {
      window.dataSdk.addHandler(dataHandler);
    }
  }
  
  // Dark Mode Toggle
  let isDarkMode = false;
  
  function toggleDarkMode() {
    isDarkMode = !isDarkMode;
    document.body.classList.toggle('dark-mode', isDarkMode);
    updateDarkModeIcon();
    localStorage.setItem('darkMode', isDarkMode);
  }
  
  function loadDarkModePreference() {
    isDarkMode = localStorage.getItem('darkMode') === 'true';
    document.body.classList.toggle('dark-mode', isDarkMode);
    updateDarkModeIcon();
  }
  
  function updateDarkModeIcon() {
    const icon = document.getElementById('dark-mode-icon');
    if (isDarkMode) {
      icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />';
    } else {
      icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />';
    }
  }
  
  // Bookmarks Feature
  let bookmarks = [];
  
  function loadBookmarks() {
    const saved = localStorage.getItem('bookmarks');
    if (saved) {
      bookmarks = JSON.parse(saved);
    }
  }
  
  function saveBookmarks() {
    localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
  }
  
  function toggleBookmark() {
    if (!currentLesson || !currentCourseId) return;
    
    const bookmarkId = `${currentCourseId}-${currentLesson.id}`;
    const index = bookmarks.indexOf(bookmarkId);
    const btn = document.getElementById('bookmark-btn');
    
    if (index > -1) {
      bookmarks.splice(index, 1);
      btn.classList.remove('bookmarked');
      showToast('Li√ß√£o removida dos salvos');
    } else {
      bookmarks.push(bookmarkId);
      btn.classList.add('bookmarked');
      showToast('Li√ß√£o salva com sucesso! üìö');
    }
    
    saveBookmarks();
    updateBookmarkButton();
  }
  
  function updateBookmarkButton() {
    if (!currentLesson || !currentCourseId) return;
    
    const bookmarkId = `${currentCourseId}-${currentLesson.id}`;
    const btn = document.getElementById('bookmark-btn');
    
    if (bookmarks.includes(bookmarkId)) {
      btn.classList.add('bookmarked');
    } else {
      btn.classList.remove('bookmarked');
    }
  }
  
  function renderBookmarks() {
    const container = document.getElementById('bookmarks-list');
    container.innerHTML = '';
    
    if (bookmarks.length === 0) {
      container.innerHTML = `
        <div class="text-center py-12">
          <div class="w-20 h-20 mx-auto rounded-full bg-amber-100 flex items-center justify-center mb-4">
            <svg class="w-10 h-10 text-amber-400" fill="none" stroke="currentColor" viewbox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z" />
            </svg>
          </div>
          <h3 class="font-semibold text-amber-800 mb-2">Nenhuma li√ß√£o salva</h3>
          <p class="text-sm text-amber-600">Salve li√ß√µes para acess√°-las rapidamente!</p>
        </div>
      `;
      return;
    }
    
    bookmarks.forEach(bookmarkId => {
      const [courseId, lessonId] = bookmarkId.split('-');
      const course = coursesData.find(c => c.id === courseId);
      const lesson = course?.lessons.find(l => l.id === lessonId);
      
      if (!lesson) return;
      
      const bookmarkEl = document.createElement('div');
      bookmarkEl.className = 'bg-white rounded-xl p-4 shadow-md card-hover cursor-pointer transition-colors duration-500';
      bookmarkEl.innerHTML = `
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 rounded-lg bg-amber-100 flex items-center justify-center">
            <svg class="w-6 h-6 text-amber-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
            </svg>
          </div>
          <div class="flex-1">
            <h4 class="font-semibold text-amber-900 text-sm transition-colors duration-500">${lesson.title}</h4>
            <p class="text-xs text-amber-600 transition-colors duration-500">${course?.title || 'Curso'}</p>
          </div>
          <svg class="w-5 h-5 text-amber-400" fill="none" stroke="currentColor" viewbox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </div>
      `;
      bookmarkEl.onclick = () => openLesson(courseId, lessonId);
      container.appendChild(bookmarkEl);
    });
  }
  
  // Search Functionality
  function handleSearch(query) {
    const resultsContainer = document.getElementById('search-results');
    
    if (!query.trim()) {
      resultsContainer.classList.add('hidden');
      return;
    }
    
    query = query.toLowerCase();
    const results = [];
    
    // Search courses
    coursesData.forEach(course => {
      if (course.title.toLowerCase().includes(query) || 
          course.description.toLowerCase().includes(query)) {
        results.push({ type: 'course', data: course });
      }
      
      // Search lessons
      course.lessons.forEach(lesson => {
        if (lesson.title.toLowerCase().includes(query) || 
            lesson.subtitle.toLowerCase().includes(query) ||
            lesson.content.toLowerCase().includes(query) ||
            lesson.verse.toLowerCase().includes(query)) {
          results.push({ type: 'lesson', data: lesson, course: course });
        }
      });
    });
    
    if (results.length === 0) {
      resultsContainer.innerHTML = `
        <div class="text-center py-8 text-amber-600">
          <p>Nenhum resultado encontrado para "${query}"</p>
        </div>
      `;
    } else {
      resultsContainer.innerHTML = results.slice(0, 5).map(result => {
        if (result.type === 'course') {
          return `
            <div onclick="showScreen('courses')" class="bg-white rounded-lg p-3 shadow-sm hover:shadow-md transition cursor-pointer">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-amber-100 flex items-center justify-center text-lg">${result.data.icon}</div>
                <div>
                  <h4 class="font-semibold text-amber-900 text-sm">${result.data.title}</h4>
                  <p class="text-xs text-amber-600">Curso</p>
                </div>
              </div>
            </div>
          `;
        } else {
          return `
            <div onclick="openLesson('${result.course.id}', '${result.data.id}')" class="bg-white rounded-lg p-3 shadow-sm hover:shadow-md transition cursor-pointer">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center">
                  <svg class="w-5 h-5 text-orange-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                  </svg>
                </div>
                <div>
                  <h4 class="font-semibold text-amber-900 text-sm">${result.data.title}</h4>
                  <p class="text-xs text-amber-600">${result.course.title} ‚Ä¢ Li√ß√£o</p>
                </div>
              </div>
            </div>
          `;
        }
      }).join('');
    }
    
    resultsContainer.classList.remove('hidden');
  }
  
  // Confetti Animation for Achievements
  function triggerConfetti() {
    const colors = ['#D4AF37', '#F59E0B', '#10B981', '#3B82F6', '#EF4444'];
    
    for (let i = 0; i < 50; i++) {
      const confetti = document.createElement('div');
      confetti.className = 'confetti';
      confetti.style.left = Math.random() * 100 + 'vw';
      confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
      confetti.style.animationDelay = Math.random() * 2 + 's';
      confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
      document.body.appendChild(confetti);
      
      setTimeout(() => confetti.remove(), 3000);
    }
  }
  
  // Enhanced Toast Notification
  function showToast(message, duration = 3000) {
    const existingToast = document.querySelector('.toast');
    if (existingToast) {
      existingToast.remove();
    }
    
    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => toast.classList.add('show'), 10);
    setTimeout(() => {
      toast.classList.remove('show');
      setTimeout(() => toast.remove(), 400);
    }, duration);
  }
  
  function showAbout() {
    showToast('Academia B√≠blica v2.0 - Feito com ‚ù§Ô∏è', 4000);
    toggleMenu();
  }
  
  // Chat Functions
  function toggleChat() {
    const wrapper = document.getElementById('chat-wrapper');
    const input = document.getElementById('chat-input');
    
    wrapper.classList.toggle('chat-active');
    
    if (wrapper.classList.contains('chat-active')) {
      setTimeout(() => input.focus(), 400);
    }
  }

  async function sendChatMessage() {
    const input = document.getElementById('chat-input');
    const messageContainer = document.getElementById('chat-messages');
    const text = input.value.trim();

    if (!text) return;

    appendMessage('user', text);
    input.value = '';

    const loadingId = 'loading-' + Date.now();
    const loadingHtml = `<div id="${loadingId}" class="chat-bubble bubble-ia flex gap-1">
      <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
      <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
      <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.4s"></div>
    </div>`;
    messageContainer.insertAdjacentHTML('beforeend', loadingHtml);
    messageContainer.scrollTop = messageContainer.scrollHeight;

    setTimeout(() => {
      document.getElementById(loadingId).remove();
      const responses = [
        "Essa √© uma excelente pergunta teol√≥gica. O conhecimento b√≠blico nos ensina que a f√© √© a certeza das coisas que se esperam. Como posso aprofundar esse tema com voc√™?",
        "Que pergunta inspiradora! A Palavra de Deus nos orienta: 'Busquei o Senhor, e ele me respondeu; livrou-me de todos os meus temores.' (Salmos 34:4)",
        "Interessante reflex√£o! A B√≠blia √© rica em sabedoria para essas quest√µes. Vamos explorar juntos o que as Escrituras nos ensinam sobre isso.",
        "Grande pergunta! O estudo da B√≠blia nos revela princ√≠pios fundamentais para nossa jornada de f√©. Posso te ajudar a entender melhor?",
        "Que b√™n√ß√£o essa pergunta! A sabedoria divina est√° dispon√≠vel para todos n√≥s que buscam. Vamos mergulhar nas Escrituras juntos?"
      ];
      const randomResponse = responses[Math.floor(Math.random() * responses.length)];
      appendMessage('ia', randomResponse);
    }, 1500);
  }

  function appendMessage(sender, text) {
    const messageContainer = document.getElementById('chat-messages');
    const div = document.createElement('div');
    div.className = `chat-bubble bubble-${sender}`;
    div.innerText = text;
    messageContainer.appendChild(div);
    messageContainer.scrollTop = messageContainer.scrollHeight;
  }

  document.getElementById('chat-input')?.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') sendChatMessage();
  });
  
  // Menu Functions
  function toggleMenu() {
    const menu = document.getElementById('super-menu');
    const isClosed = menu.classList.contains('menu-closed');
    
    if (isClosed) {
      menu.classList.remove('menu-closed');
      menu.classList.remove('pointer-events-none');
      menu.classList.add('menu-open');
    } else {
      menu.classList.remove('menu-open');
      menu.classList.add('menu-closed');
      menu.classList.add('pointer-events-none');
    }
  }

  function menuNavigate(screenName) {
    toggleMenu();
    setTimeout(() => {
      showScreen(screenName);
    }, 100);
  }
  
  // Course and Lesson Data
  const coursesData = [
    {
      id: 'fundamentos',
      title: 'Fundamentos da F√©',
      description: 'Aprenda os pilares essenciais da f√© crist√£',
      icon: '‚õ™',
      lessons: [
        {
          id: 'fund-1',
          title: 'A Natureza de Deus',
          audio: 'audios/natureza.mp3',
          subtitle: 'Conhecendo o Criador',
          image: 'natureza.jpg',
          content: `<p><strong>Deus √© o criador de todas as coisas.</strong> Desde o in√≠cio dos tempos, Ele estabeleceu os c√©us e a terra com Sua palavra poderosa.</p>
            <p>A B√≠blia nos revela que Deus possui atributos √∫nicos e incompar√°veis:</p>
            <p><strong>1. Onipot√™ncia:</strong> Deus tem todo o poder. N√£o h√° nada imposs√≠vel para Ele. Como est√° escrito: "Para Deus todas as coisas s√£o poss√≠veis" (Mateus 19:26).</p>
            <p><strong>2. Onisci√™ncia:</strong> Deus conhece todas as coisas - o passado, o presente e o futuro. Ele conhece nossos pensamentos antes mesmo de os expressarmos.</p>
            <p><strong>3. Onipresen√ßa:</strong> Deus est√° em todos os lugares ao mesmo tempo. N√£o h√° lugar onde possamos fugir de Sua presen√ßa.</p>
            <p><strong>4. Amor:</strong> "Deus √© amor" (1 Jo√£o 4:8). Este √© o atributo que mais nos aproxima dEle, pois Seu amor √© incondicional e eterno.</p>`,
          verse: 'No princ√≠pio, Deus criou os c√©us e a terra.',
          reference: 'G√™nesis 1:1',
          quiz: [
            { question: 'Qual atributo de Deus significa que Ele tem todo o poder?', options: ['Onisci√™ncia', 'Onipot√™ncia', 'Onipresen√ßa', 'Bondade'], correct: 1 },
            { question: 'O que significa dizer que Deus √© onisciente?', options: ['Est√° em todos os lugares', 'Tem todo poder', 'Conhece todas as coisas', '√â eterno'], correct: 2 },
            { question: 'Segundo 1 Jo√£o 4:8, Deus √©...', options: ['Justi√ßa', 'Amor', 'Poder', 'Sabedoria'], correct: 1 }
          ]
        },
        {
          id: 'fund-2',
          title: 'A Palavra de Deus',
          audio: '',
          subtitle: 'A B√≠blia como guia de vida',
          image: 'palavra.jpg',
          content: `<p><strong>A B√≠blia √© a Palavra inspirada de Deus.</strong> Ela √© nosso manual de vida, nossa luz no caminho e nossa fonte de sabedoria.</p>
            <p>A Escritura Sagrada foi escrita por aproximadamente 40 autores diferentes, ao longo de cerca de 1.500 anos, mas mant√©m uma unidade perfeita porque foi inspirada pelo Esp√≠rito Santo.</p>
            <p><strong>Import√¢ncia da B√≠blia:</strong></p>
            <p>‚Ä¢ Ela nos revela quem Deus √© e Seu plano de salva√ß√£o</p>
            <p>‚Ä¢ Ela nos ensina como viver de forma agrad√°vel a Deus</p>
            <p>‚Ä¢ Ela nos fortalece nos momentos dif√≠ceis</p>
            <p>‚Ä¢ Ela nos transforma √† imagem de Cristo</p>
            <p>Quando lemos a B√≠blia com f√© e disposi√ß√£o, Deus fala conosco de maneira pessoal e transformadora.</p>`,
          verse: 'L√¢mpada para os meus p√©s √© a tua palavra e luz para o meu caminho.',
          reference: 'Salmos 119:105',
          quiz: [
            { question: 'Quantos autores aproximadamente escreveram a B√≠blia?', options: ['10', '40', '66', '100'], correct: 1 },
            { question: 'A B√≠blia foi inspirada por quem?', options: ['Os ap√≥stolos', 'O Esp√≠rito Santo', 'Os profetas', 'Os reis'], correct: 1 },
            { question: 'Segundo Salmos 119:105, a Palavra de Deus √© comparada a...', options: ['√Ågua', 'P√£o', 'L√¢mpada', 'Espada'], correct: 2 }
          ]
        },
        {
          id: 'fund-3',
          title: 'A Salva√ß√£o em Cristo',
          audio: '',
          subtitle: 'O plano redentor de Deus',
          image: 'salvacao.jpg',
          content: `<p><strong>Jesus Cristo √© o √∫nico caminho para a salva√ß√£o.</strong> Atrav√©s de Seu sacrif√≠cio na cruz, Ele pagou o pre√ßo pelos nossos pecados.</p>
            <p>A salva√ß√£o √© um presente gratuito de Deus, n√£o algo que podemos conquistar por nossos pr√≥prios m√©ritos ou boas obras.</p>
            <p><strong>Os passos para a salva√ß√£o:</strong></p>
            <p><strong>1. Reconhecer:</strong> Precisamos reconhecer que somos pecadores e que necessitamos de um Salvador.</p>
            <p><strong>2. Arrepender:</strong> Devemos nos arrepender genuinamente de nossos pecados, desejando abandon√°-los.</p>
            <p><strong>3. Crer:</strong> Precisamos crer que Jesus morreu por n√≥s e ressuscitou ao terceiro dia.</p>
            <p><strong>4. Confessar:</strong> Devemos confessar Jesus como nosso Senhor e Salvador.</p>
            <p>Quando fazemos isso, recebemos a vida eterna e nos tornamos filhos de Deus!</p>`,
          verse: 'Porque Deus amou o mundo de tal maneira que deu o seu Filho unig√™nito, para que todo aquele que nele cr√™ n√£o pere√ßa, mas tenha a vida eterna.',
          reference: 'Jo√£o 3:16',
          quiz: [
            { question: 'A salva√ß√£o √© conquistada por...', options: ['Boas obras', 'Frequentar a igreja', 'F√© em Jesus Cristo', 'Doa√ß√µes'], correct: 2 },
            { question: 'Qual o primeiro passo para a salva√ß√£o mencionado na li√ß√£o?', options: ['Confessar', 'Crer', 'Reconhecer', 'Arrepender'], correct: 2 },
            { question: 'Segundo Jo√£o 3:16, Deus deu Seu Filho para que tenhamos...', options: ['Prosperidade', 'Sa√∫de', 'Vida eterna', 'Sabedoria'], correct: 2 }
          ]
        }
      ]
    },
    {
      id: 'oracao',
      title: 'Vida de Ora√ß√£o',
      audio: '',
      description: 'Desenvolva uma vida de comunh√£o com Deus',
      icon: 'üôè',
      lessons: [
        {
          id: 'ora-1',
          title: 'O Que √© Ora√ß√£o',
          subtitle: 'Conversando com o Pai',
          image: 'oracao.jpg',
          content: `<p><strong>Ora√ß√£o √© comunh√£o com Deus.</strong> √â o meio pelo qual nos aproximamos do Pai celestial, expressamos nosso cora√ß√£o e ouvimos Sua voz.</p>
            <p>Muitas pessoas pensam que orar √© apenas pedir coisas a Deus, mas a ora√ß√£o √© muito mais do que isso.</p>
            <p><strong>Elementos da ora√ß√£o:</strong></p>
            <p><strong>Adora√ß√£o:</strong> Reconhecemos quem Deus √© e O exaltamos por Seus atributos.</p>
            <p><strong>Confiss√£o:</strong> Confessamos nossos pecados e pedimos perd√£o.</p>
            <p><strong>Agradecimento:</strong> Expressamos gratid√£o por tudo que Deus tem feito.</p>
            <p><strong>S√∫plica:</strong> Apresentamos nossos pedidos e necessidades.</p>
            <p>Jesus nos ensinou a orar e nos deu o exemplo perfeito de uma vida de ora√ß√£o constante.</p>`,
          verse: 'Orai sem cessar.',
          reference: '1 Tessalonicenses 5:17',
          quiz: [
            { question: 'Ora√ß√£o √© principalmente...', options: ['Pedir coisas', 'Comunh√£o com Deus', 'Ritual religioso', 'Medita√ß√£o'], correct: 1 },
            { question: 'Qual elemento da ora√ß√£o envolve reconhecer quem Deus √©?', options: ['Confiss√£o', 'S√∫plica', 'Adora√ß√£o', 'Agradecimento'], correct: 2 },
            { question: 'Segundo 1 Tessalonicenses 5:17, devemos orar...', options: ['Uma vez ao dia', 'Apenas aos domingos', 'Sem cessar', 'Quando precisarmos'], correct: 2 }
          ]
        }
      ]
    }
  ];

  // App State
  let currentScreen = 'home';
  let currentLesson = null;
  let currentCourseId = null;
  let currentQuizIndex = 0;
  let quizAnswers = [];
  let userProgress = [];
  let speechSynthesis = window.speechSynthesis;
  let currentUtterance = null;
  let isPlaying = false;

  const defaultConfig = {
    app_title: 'Academia B√≠blica',
    welcome_message: 'Buscai o Senhor enquanto se pode achar, invocai-o enquanto est√° perto.',
    background_color: '#FFFBEB',
    surface_color: '#FFFFFF',
    text_color: '#78350F',
    primary_action_color: '#D4AF37',
    secondary_action_color: '#F59E0B',
    font_family: 'Playfair Display',
    font_size: 16
  };

  let config = { ...defaultConfig };
  
  // Data Handler
  const dataHandler = {
    onDataChanged(data) {
      userProgress = data;
      updateUI();
    }
  };

  // Element SDK Handler
  const elementHandler = {
    defaultConfig,
    async onConfigChange(newConfig) {
      config = { ...defaultConfig, ...newConfig };
      applyConfig();
    },
    mapToCapabilities(cfg) {
      return {
        recolorables: [
          { get: () => cfg.background_color || defaultConfig.background_color, set: (v) => { config.background_color = v; if(window.elementSdk) window.elementSdk.setConfig({ background_color: v }); } },
          { get: () => cfg.surface_color || defaultConfig.surface_color, set: (v) => { config.surface_color = v; if(window.elementSdk) window.elementSdk.setConfig({ surface_color: v }); } },
          { get: () => cfg.text_color || defaultConfig.text_color, set: (v) => { config.text_color = v; if(window.elementSdk) window.elementSdk.setConfig({ text_color: v }); } },
          { get: () => cfg.primary_action_color || defaultConfig.primary_action_color, set: (v) => { config.primary_action_color = v; if(window.elementSdk) window.elementSdk.setConfig({ primary_action_color: v }); } },
          { get: () => cfg.secondary_action_color || defaultConfig.secondary_action_color, set: (v) => { config.secondary_action_color = v; if(window.elementSdk) window.elementSdk.setConfig({ secondary_action_color: v }); } }
        ],
        borderables: [],
        fontEditable: {
          get: () => cfg.font_family || defaultConfig.font_family,
          set: (v) => { config.font_family = v; if(window.elementSdk) window.elementSdk.setConfig({ font_family: v }); }
        },
        fontSizeable: {
          get: () => cfg.font_size || defaultConfig.font_size,
          set: (v) => { config.font_size = v; if(window.elementSdk) window.elementSdk.setConfig({ font_size: v }); }
        }
      };
    },
    mapToEditPanelValues(cfg) {
      return new Map([
        ['app_title', cfg.app_title || defaultConfig.app_title],
        ['welcome_message', cfg.welcome_message || defaultConfig.welcome_message]
      ]);
    }
  };

  function applyConfig() {
    const body = document.body;
    body.style.backgroundColor = config.background_color;
    
    const surfaces = document.querySelectorAll('.bg-white');
    surfaces.forEach(el => el.style.backgroundColor = config.surface_color);
    
    const textElements = document.querySelectorAll('.text-amber-900, .text-amber-800, .text-amber-700');
    textElements.forEach(el => el.style.color = config.text_color);
    
    const primaryButtons = document.querySelectorAll('.gold-bg');
    primaryButtons.forEach(el => el.style.backgroundColor = config.primary_action_color);
    
    const goldTexts = document.querySelectorAll('.gold-text');
    goldTexts.forEach(el => el.style.color = config.primary_action_color);
    
    document.getElementById('header-title').textContent = config.app_title;
    document.getElementById('welcome-title').textContent = config.welcome_message;
    
    const displayFont = `${config.font_family}, Playfair Display, serif`;
    document.querySelectorAll('.font-display').forEach(el => {
      el.style.fontFamily = displayFont;
    });
    
    const baseSize = config.font_size;
    document.querySelectorAll('h1').forEach(el => el.style.fontSize = `${baseSize * 1.5}px`);
    document.querySelectorAll('h2').forEach(el => el.style.fontSize = `${baseSize * 1.4}px`);
    document.querySelectorAll('h3').forEach(el => el.style.fontSize = `${baseSize * 1.2}px`);
    document.querySelectorAll('p, span').forEach(el => {
      if (!el.closest('.text-xs') && !el.closest('.text-sm')) {
        el.style.fontSize = `${baseSize}px`;
      }
    });
  }

  function showScreen(screenId) {
    document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
    const screen = document.getElementById(`screen-${screenId}`);
    if (screen) {
      screen.classList.remove('hidden');
      screen.classList.add('animate-fade');
    }
    
    document.querySelectorAll('.nav-item').forEach(btn => {
      btn.classList.remove('active');
      const icon = btn.querySelector('svg');
      const text = btn.querySelector('span');
      if (icon) icon.classList.remove('text-amber-500');
      if (icon) icon.classList.add('text-gray-400');
      if (text) text.classList.remove('text-amber-700', 'font-medium');
      if (text) text.classList.add('text-gray-500');
    });
    
    const activeBtn = document.querySelector(`.nav-item[data-screen="${screenId}"]`);
    if (activeBtn) {
      activeBtn.classList.add('active');
      const icon = activeBtn.querySelector('svg');
      const text = activeBtn.querySelector('span');
      if (icon) icon.classList.add('text-amber-500');
      if (icon) icon.classList.remove('text-gray-400');
      if (text) text.classList.add('text-amber-700', 'font-medium');
      if (text) text.classList.remove('text-gray-500');
    }
    
    currentScreen = screenId;
    
    if (screenId === 'courses') renderCourses();
    if (screenId === 'certificates') renderCertificates();
    if (screenId === 'bookmarks') renderBookmarks();
    
    stopAudio();
  }

  function enrollInCourse(courseId) {
    const btn = event ? event.currentTarget : null;
    if(btn) {
       btn.innerHTML = "Processando...";
       btn.style.opacity = "0.7";
    }

    setTimeout(() => {
      if (!enrolledCourses.includes(courseId)) {
        enrolledCourses.push(courseId);
        localStorage.setItem('app_enrolled', JSON.stringify(enrolledCourses));
      }

      showToast('Inscri√ß√£o realizada com sucesso! üéâ');
      
      renderCourses();
      
    }, 500);
  }

  // Progress Management
  let enrolledCourses = JSON.parse(localStorage.getItem('app_enrolled')) || [];
  let completedLessons = JSON.parse(localStorage.getItem('app_completed')) || [];
  let quizAttempts = JSON.parse(localStorage.getItem('quiz_attempts')) || {};
  let quizScores = JSON.parse(localStorage.getItem('quiz_scores')) || {};

  const MAX_ATTEMPTS = 3;
  const MIN_AVERAGE = 70;

  function isEnrolledInCourse(courseId) {
    return enrolledCourses.includes(courseId);
  }

  function isLessonUnlocked(courseId, lessonId) {
    if (!isEnrolledInCourse(courseId)) return false;

    const course = coursesData.find(c => c.id === courseId);
    if (!course) return false;
    
    const lessonIndex = course.lessons.findIndex(l => l.id === lessonId);
    
    if (lessonIndex === 0) return true; 
    
    const previousLesson = course.lessons[lessonIndex - 1];
    return completedLessons.includes(previousLesson.id);
  }
    
  function isLessonCompleted(lessonId) {
    return completedLessons.includes(lessonId);
  }

  function renderCourses() {
    const container = document.getElementById('courses-list');
    container.innerHTML = '';
    
    coursesData.forEach((course, courseIndex) => {
      const enrolled = isEnrolledInCourse(course.id);
      
      const lessonsCompletedCount = course.lessons.filter(l => 
        completedLessons.includes(l.id)
      ).length;
      
      const progress = enrolled ? (lessonsCompletedCount / course.lessons.length) * 100 : 0;
      
      const courseEl = document.createElement('div');
      courseEl.className = 'bg-white rounded-2xl p-4 shadow-lg card-hover lesson-card relative transition-colors duration-500';
      courseEl.style.animationDelay = `${courseIndex * 0.1}s`;
      
      if (!enrolled) {
        courseEl.innerHTML = `
          <div class="flex items-center gap-4 mb-4">
            <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center text-2xl shadow-md">${course.icon}</div>
            <div class="flex-1">
              <h3 class="font-display font-bold text-amber-900 transition-colors duration-500">${course.title}</h3>
              <p class="text-sm text-amber-600 transition-colors duration-500">${course.description}</p>
            </div>
          </div>
          <button onclick="enrollInCourse('${course.id}')" class="w-full py-3 gold-bg text-white rounded-xl font-semibold shadow-md hover:shadow-lg transition">üéì Inscrever-se</button>
        `;
      } else {
        courseEl.innerHTML = `
          <div class="flex items-center gap-4 mb-4">
            <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center text-2xl shadow-md">${course.icon}</div>
            <div class="flex-1">
              <h3 class="font-display font-bold text-amber-900 transition-colors duration-500">${course.title}</h3>
              <p class="text-sm text-amber-600 transition-colors duration-500">${course.description}</p>
            </div>
          </div>
          <div class="mb-3">
            <div class="flex justify-between text-sm mb-1">
              <span class="text-amber-700 transition-colors duration-500">${lessonsCompletedCount}/${course.lessons.length} li√ß√µes</span>
              <span class="font-semibold gold-text">${Math.round(progress)}%</span>
            </div>
            <div class="h-2 bg-amber-100 rounded-full overflow-hidden transition-colors duration-500">
              <div class="h-full gold-bg rounded-full progress-fill transition-all duration-500" style="width: ${progress}%"></div>
            </div>
          </div>
          <div class="space-y-2">
            ${course.lessons.map((lesson, idx) => {
              const isCompleted = isLessonCompleted(lesson.id);
              const isUnlocked = isLessonUnlocked(course.id, lesson.id);
              
              if (!isUnlocked) {
                return `
                  <div class="w-full flex items-center gap-3 p-3 rounded-xl bg-gray-100 border border-gray-200 opacity-60 transition-colors duration-500">
                    <div class="w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center text-gray-500">üîí</div>
                    <div class="flex-1 text-sm text-gray-500">${lesson.title}</div>
                  </div>`;
              }
              
              return `
                <button onclick="openLesson('${course.id}', '${lesson.id}')" class="w-full flex items-center gap-3 p-3 rounded-xl ${isCompleted ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200'} transition text-left transition-colors duration-500">
                  <div class="w-8 h-8 rounded-full ${isCompleted ? 'bg-green-500 text-white' : 'bg-amber-400 text-white'} flex items-center justify-center text-sm font-bold">
                    ${isCompleted ? '‚úì' : idx + 1}
                  </div>
                  <div class="flex-1">
                    <p class="font-medium text-amber-900 text-sm transition-colors duration-500">${lesson.title}</p>
                    <p class="text-xs text-amber-600 transition-colors duration-500">${lesson.subtitle}</p>
                  </div>
                </button>`;
            }).join('')}
          </div>
        `;
      }
      container.appendChild(courseEl);
    });
  }

  function openLesson(courseId, lessonId) {
    if (typeof isLessonUnlocked === 'function' && !isLessonUnlocked(courseId, lessonId)) {
      showToast('Complete a li√ß√£o anterior primeiro! üîí');
      return;
    }

    const course = coursesData.find(c => c.id === courseId);
    const lesson = course?.lessons.find(l => l.id === lessonId);
    if (!lesson) return;

    currentLesson = lesson;
    currentCourseId = courseId;
    currentQuizIndex = 0;
    quizAnswers = [];

    const headerBg = document.getElementById('lesson-header-bg');
    
    if (lesson.image) {
        headerBg.style.backgroundImage = `url('${lesson.image}')`;
    } else {
        headerBg.style.backgroundImage = 'linear-gradient(to bottom right, #fbbf24, #f97316)';
    }

    document.getElementById('lesson-title').textContent = lesson.title;
    document.getElementById('lesson-subtitle').textContent = lesson.subtitle;
    document.getElementById('lesson-text').innerHTML = lesson.content;
    document.getElementById('lesson-verse').textContent = `"${lesson.verse}"`;
    document.getElementById('lesson-reference').textContent = `- ${lesson.reference}`;

    updateBookmarkButton();
    renderQuiz();
    showScreen('lesson');
    showLessonTab('content'); 
  }

  function showLessonTab(tabId) {
    document.querySelectorAll('.lesson-content').forEach(c => c.classList.add('hidden'));
    
    document.querySelectorAll('.lesson-tab').forEach(t => {
        t.classList.remove('bg-amber-100', 'text-amber-800');
        t.classList.add('bg-gray-100', 'text-gray-600');
    });

    const tab = document.getElementById(`tab-${tabId}`);
    if (tab) {
        tab.classList.remove('hidden');
        tab.classList.add('animate-fade');
    }

    const activeTabBtn = document.querySelector(`.lesson-tab[data-tab="${tabId}"]`);
    if (activeTabBtn) {
      activeTabBtn.classList.add('bg-amber-100', 'text-amber-800');
      activeTabBtn.classList.remove('bg-gray-100', 'text-gray-600');
    }

    if (tabId === 'audio') {
        renderAudioPlayer();
    } else {
        const player = document.getElementById('lesson-audio-player');
        if (player) player.pause();
    }
  }
  
  function renderAudioPlayer() {
    const audioTab = document.getElementById('tab-audio');
    
    const audioPath = currentLesson.audio || coursesData.find(c => c.id === currentCourseId)?.audio;

    if (!audioPath) {
        audioTab.innerHTML = `
            <div class="p-10 text-center">
                <p class="text-gray-500 italic">√Åudio n√£o dispon√≠vel para esta li√ß√£o.</p>
            </div>`;
        return;
    }

    audioTab.innerHTML = `
        <div class="bg-white rounded-3xl p-8 shadow-xl border border-amber-100 text-center animate-fade transition-colors duration-500">
            <div class="w-20 h-20 mx-auto bg-gradient-to-br from-amber-500 to-orange-600 rounded-full flex items-center justify-center text-white mb-4 shadow-lg">
                <svg class="w-10 h-10" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M18 3a1 1 0 00-1.196-.98l-10 2A1 1 0 006 5v9.114A4.369 4.369 0 005 14c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V7.82l8-1.6v5.894A4.37 4.37 0 0015 14c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V3z"/>
                </svg>
            </div>
            <h3 class="font-display font-bold text-xl text-amber-900 mb-1 transition-colors duration-500">Escutar Li√ß√£o</h3>
            <p class="text-sm text-amber-600 mb-6 italic transition-colors duration-500">Narra√ß√£o oficial da Academia</p>
            
            <audio id="lesson-audio-player" controls class="w-full h-12">
                <source src="${audioPath}" type="audio/mpeg">
                Seu navegador n√£o suporta √°udio.
            </audio>
        </div>
    `;
  }
  
  function getAttemptsLeft(lessonId) {
    if (!(lessonId in quizAttempts)) {
      quizAttempts[lessonId] = MAX_ATTEMPTS;
    }
    return quizAttempts[lessonId];
  }

  function consumeAttempt(lessonId) {
    quizAttempts[lessonId]--;
    localStorage.setItem('quiz_attempts', JSON.stringify(quizAttempts));
  }

  function saveLessonScore(lessonId, score) {
    quizScores[lessonId] = score;
    localStorage.setItem('quiz_scores', JSON.stringify(quizScores));
  }

  function calculateCourseAverage(courseId) {
    const course = coursesData.find(c => c.id === courseId);
    if (!course) return 0;

    const scores = course.lessons
      .map(l => quizScores[l.id])
      .filter(s => typeof s === 'number');

    if (scores.length === 0) return 0;

    const sum = scores.reduce((a, b) => a + b, 0);
    return Math.round(sum / scores.length);
  }

  function renderQuiz() {
    const container = document.getElementById('quiz-container');
    const quiz = currentLesson?.quiz || [];
    
    if (currentQuizIndex >= quiz.length) {
      showQuizResult();
      return;
    }
    
    const q = quiz[currentQuizIndex];
    container.innerHTML = `
      <div class="mb-4">
        <div class="flex justify-between items-center mb-2">
          <span class="text-sm text-amber-600 transition-colors duration-500">Quest√£o ${currentQuizIndex + 1} de ${quiz.length}</span>
          <span class="text-sm font-semibold gold-text">${Math.round(((currentQuizIndex) / quiz.length) * 100)}%</span>
        </div>
        <div class="h-2 bg-amber-100 rounded-full overflow-hidden transition-colors duration-500">
          <div class="h-full gold-bg rounded-full progress-fill transition-all duration-300" style="width: ${((currentQuizIndex) / quiz.length) * 100}%"></div>
        </div>
      </div>
      <div class="bg-white rounded-xl p-4 shadow-md mb-4 transition-colors duration-500">
        <h3 class="font-semibold text-amber-900 text-lg mb-4 transition-colors duration-500">${q.question}</h3>
        <div class="space-y-3">
          ${q.options.map((opt, idx) => `
            <button onclick="selectAnswer(${idx})" class="quiz-option w-full p-4 rounded-xl border-2 border-amber-200 text-left text-amber-800 font-medium transition-colors duration-500">
              <span class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-amber-100 text-amber-700 text-sm font-bold mr-3">${String.fromCharCode(65 + idx)}</span>
              ${opt}
            </button>
          `).join('')}
        </div>
      </div>
    `;
    
    document.getElementById('quiz-result').classList.add('hidden');
    container.classList.remove('hidden');
  }

  function selectAnswer(answerIndex) {
    const quiz = currentLesson?.quiz || [];
    const q = quiz[currentQuizIndex];
    const isCorrect = answerIndex === q.correct;
    
    quizAnswers.push({ questionIndex: currentQuizIndex, answer: answerIndex, correct: isCorrect });
    
    const options = document.querySelectorAll('.quiz-option');
    options.forEach((opt, idx) => {
      opt.disabled = true;
      if (idx === q.correct) {
        opt.classList.add('correct');
      } else if (idx === answerIndex && !isCorrect) {
        opt.classList.add('incorrect');
      }
    });
    
    setTimeout(() => {
      currentQuizIndex++;
      renderQuiz();
    }, 1500);
  }

  function showQuizResult() {
    const container = document.getElementById('quiz-container');
    const resultDiv = document.getElementById('quiz-result');
    
    container.classList.add('hidden');
    resultDiv.classList.remove('hidden');
    
    const correctCount = quizAnswers.filter(a => a.correct).length;
    const totalQuestions = currentLesson.quiz.length;
    const score = Math.round((correctCount / totalQuestions) * 100);

    saveLessonScore(currentLesson.id, score);
    
    const resultIcon = document.getElementById('result-icon');
    const resultTitle = document.getElementById('result-title');
    const resultMessage = document.getElementById('result-message');
    
    if (score >= 70) {
      resultIcon.className = 'w-20 h-20 mx-auto rounded-full bg-green-100 flex items-center justify-center mb-4';
      resultIcon.innerHTML = '<span class="text-4xl">üéâ</span>';
      resultTitle.textContent = 'Parab√©ns!';
      resultTitle.className = 'font-display text-2xl font-bold text-green-700 mb-2';
      resultMessage.textContent = 'Voc√™ demonstrou um excelente conhecimento!';
      
      // Trigger confetti for achievements
      triggerConfetti();
    } else {
      resultIcon.className = 'w-20 h-20 mx-auto rounded-full bg-amber-100 flex items-center justify-center mb-4';
      resultIcon.innerHTML = '<span class="text-4xl">üìö</span>';
      resultTitle.textContent = 'Continue Estudando!';
      resultTitle.className = 'font-display text-2xl font-bold text-amber-700 mb-2';
      resultMessage.textContent = 'Revise o conte√∫do e tente novamente.';
    }
    
    document.getElementById('result-score').textContent = `${score}%`;
  }

  function retakeQuiz() {
    currentQuizIndex = 0;
    quizAnswers = [];
    renderQuiz();
  }

  async function completeLesson() {
    if (!currentLesson || !currentCourseId) return;

    const score = Math.round(
      (quizAnswers.filter(a => a.correct).length / currentLesson.quiz.length) * 100
    );

    let attemptsLeft = getAttemptsLeft(currentLesson.id);

    if (score < MIN_AVERAGE) {
      if (attemptsLeft > 0) {
        consumeAttempt(currentLesson.id);
        showToast(`Nota ${score}%. Tentativas restantes: ${getAttemptsLeft(currentLesson.id)}`);
        retakeQuiz();
        return;
      } else {
        showToast('Tentativas esgotadas. Curso bloqueado.');
        showScreen('courses');
        return;
      }
    }

    saveLessonScore(currentLesson.id, score);

    if (!completedLessons.includes(currentLesson.id)) {
      completedLessons.push(currentLesson.id);
      localStorage.setItem('app_completed', JSON.stringify(completedLessons));
    }

    showToast(`Li√ß√£o conclu√≠da com ${score}% üéâ`);
    triggerConfetti();

    const courseAvg = calculateCourseAverage(currentCourseId);

    if (courseAvg >= MIN_AVERAGE) {
      showToast(`M√©dia final do curso: ${courseAvg}%`);
    }

    showScreen('courses');
    renderCourses();
  }

  function toggleAudio() {
    if (isPlaying) {
      stopAudio();
    } else {
      playAudio();
    }
  }

  function playAudio() {
    if (!currentLesson) return;
    
    const textContent = currentLesson.content.replace(/<[^>]*>/g, ' ').replace(/\s+/g, ' ').trim();
    const fullText = `${currentLesson.title}. ${currentLesson.subtitle}. ${textContent}. Vers√≠culo: ${currentLesson.verse}. ${currentLesson.reference}`;
    
    currentUtterance = new SpeechSynthesisUtterance(fullText);
    currentUtterance.lang = 'pt-BR';
    currentUtterance.rate = 0.9;
    currentUtterance.pitch = 1;
    
    currentUtterance.onstart = () => {
      isPlaying = true;
      updateAudioUI();
    };
    
    currentUtterance.onend = () => {
      isPlaying = false;
      updateAudioUI();
    };
    
    currentUtterance.onerror = () => {
      isPlaying = false;
      updateAudioUI();
    };
    
    speechSynthesis.speak(currentUtterance);
  }

  function stopAudio() {
    speechSynthesis.cancel();
    isPlaying = false;
    updateAudioUI();
  }

  function updateAudioUI() {
    const btn = document.getElementById('audio-btn');
    const icon = document.getElementById('audio-icon');
    const indicator = document.getElementById('speaking-indicator');
    const status = document.getElementById('audio-status');
    
    if (isPlaying) {
      btn.textContent = '‚èπÔ∏è Parar';
      icon.classList.add('hidden');
      indicator.classList.remove('hidden');
      status.textContent = 'Reproduzindo...';
    } else {
      btn.textContent = '‚ñ∂Ô∏è Reproduzir';
      icon.classList.remove('hidden');
      indicator.classList.add('hidden');
      status.textContent = 'Usando s√≠ntese de voz do navegador';
    }
  }

  function renderCertificates() {
    const container = document.getElementById('certificates-list');
    container.innerHTML = '';

    const completedCourses = coursesData.filter(course => {
      const allLessonsHaveScore = course.lessons.every(
        lesson => typeof quizScores[lesson.id] === 'number'
      );

      if (!allLessonsHaveScore) return false;

      const avg = calculateCourseAverage(course.id);
      return avg >= MIN_AVERAGE;
    });

    if (completedCourses.length === 0) {
        container.innerHTML = `
            <div class="col-span-full p-10 text-center bg-white rounded-2xl border-2 border-dashed border-amber-200 transition-colors duration-500">
                <p class="text-amber-700 italic transition-colors duration-500">Voc√™ ainda n√£o possui certificados. Conclua todas as li√ß√µes de um curso para liberar!</p>
            </div>`;
        return;
    }

    completedCourses.forEach(course => {
      const avg = calculateCourseAverage(course.id);

      const certEl = document.createElement('div');
      certEl.className = 'bg-white rounded-2xl p-6 shadow-lg border-l-4 border-amber-500 flex justify-between items-center transition-colors duration-500';
      certEl.innerHTML = `
        <div>
          <h3 class="font-display font-bold text-amber-900 text-lg transition-colors duration-500">${course.title}</h3>
          <p class="text-sm text-green-600 font-semibold">
            ‚úì Conclu√≠do com M√©dia Final: ${avg}%
          </p>
        </div>
        <button onclick="generatePDF('${course.title}', ${avg})"
          class="bg-amber-100 hover:bg-amber-200 text-amber-800 p-3 rounded-xl transition flex items-center gap-2">
          Baixar PDF
        </button>
      `;
      container.appendChild(certEl);
    });
  }

  function viewCertificate(course, score) {
    const display = document.getElementById('certificate-display');
    const date = new Date().toLocaleDateString('pt-BR', { day: 'numeric', month: 'long', year: 'numeric' });
    
    display.innerHTML = `
      <div class="text-center">
        <div class="mb-4">
          <svg class="w-16 h-16 mx-auto text-amber-600" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 2L4 5v6.09c0 5.05 3.41 9.76 8 10.91 4.59-1.15 8-5.86 8-10.91V5l-8-3zm-1.06 13.54L7.4 12l1.41-1.41 2.12 2.12 4.24-4.24 1.41 1.41-5.64 5.66z"/>
          </svg>
        </div>
        <p class="text-amber-600 uppercase tracking-widest text-sm mb-2">Certificado de Conclus√£o</p>
        <h2 class="font-display text-3xl font-bold gold-text mb-6">Academia B√≠blica</h2>
        <div class="border-t border-b border-amber-300 py-4 my-4">
          <p class="text-amber-700 mb-2">Certificamos que</p>
          <p class="font-display text-2xl font-bold text-amber-900 mb-2">Estudante</p>
          <p class="text-amber-700">concluiu com √™xito o curso</p>
        </div>
        <h3 class="font-display text-xl font-bold text-amber-900 mb-4">${course.title}</h3>
        <div class="flex justify-center gap-8 mb-6">
          <div class="text-center">
            <p class="text-xs text-amber-600 uppercase">Li√ß√µes</p>
            <p class="text-2xl font-bold gold-text">${course.lessons.length}</p>
          </div>
          <div class="text-center">
            <p class="text-xs text-amber-600 uppercase">Aproveitamento</p>
            <p class="text-2xl font-bold gold-text">${score}%</p>
          </div>
        </div>
        <div class="border-t border-amber-300 pt-4">
          <p class="text-sm text-amber-600">${date}</p>
          <div class="mt-4 flex justify-center gap-4">
            <div class="text-center">
              <div class="w-20 h-0.5 bg-amber-400 mb-1"></div>
              <p class="text-xs text-amber-600">Assinatura</p>
            </div>
          </div>
        </div>
      </div>
    `;
    
    showScreen('certificate-view');
  }

  function updateUI() {
    const totalLessonsGlobal = coursesData.reduce((sum, c) => sum + c.lessons.length, 0);
    const completedLessonsCount = completedLessons.length;
    
    const progressPercent = totalLessonsGlobal > 0 
      ? Math.round((completedLessonsCount / totalLessonsGlobal) * 100) 
      : 0;

    const circumference = 2 * Math.PI * 16;
    const offset = circumference - (progressPercent / 100) * circumference;
    
    document.getElementById('progress-circle').style.strokeDashoffset = offset;
    document.getElementById('progress-text').textContent = `${progressPercent}%`;

    const totalCourses = coursesData.length;
    document.getElementById('stat-total-courses').textContent = totalCourses;

    const coursesFinishedList = coursesData.filter(course => {
      const allLessonsDone = course.lessons.every(l => completedLessons.includes(l.id));
      return allLessonsDone;
    });

    document.getElementById('stat-finished-courses').textContent = coursesFinishedList.length;

    const certificatesCount = coursesFinishedList.filter(course => {
       const avg = calculateCourseAverage(course.id);
       return avg >= MIN_AVERAGE;
    }).length;

    document.getElementById('stat-certificates').textContent = certificatesCount;
    
    const profileLessons = document.getElementById('profile-lessons');
    if(profileLessons) profileLessons.textContent = completedLessonsCount;
    
    const profileCerts = document.getElementById('profile-certs');
    if(profileCerts) profileCerts.textContent = certificatesCount;

    let nextLesson = null;
    let nextCourse = null;
    
    for (const course of coursesData) {
      if (!isEnrolledInCourse(course.id)) continue;
      
      for (const lesson of course.lessons) {
        if (!isLessonCompleted(lesson.id) && isLessonUnlocked(course.id, lesson.id)) {
          nextLesson = lesson;
          nextCourse = course;
          break;
        }
      }
      if (nextLesson) break;
    }
    
    const continueCard = document.getElementById('continue-card');
    const continueProgress = document.getElementById('continue-progress');

    if (nextLesson) {
      document.getElementById('continue-title').textContent = nextLesson.title;
      document.getElementById('continue-subtitle').textContent = nextCourse.title;
      continueCard.onclick = () => openLesson(nextCourse.id, nextLesson.id);
      
      continueProgress.style.width = `${progressPercent}%`;
      
    } else {
      if (completedLessonsCount > 0 && completedLessonsCount === totalLessonsGlobal) {
        document.getElementById('continue-title').textContent = 'Jornada Conclu√≠da!';
        document.getElementById('continue-subtitle').textContent = 'Voc√™ completou tudo.';
        continueCard.onclick = () => showScreen('certificates');
        continueProgress.style.width = '100%';
      } else {
        document.getElementById('continue-title').textContent = 'Come√ßar um Curso';
        document.getElementById('continue-subtitle').textContent = 'Inscreva-se para aprender';
        continueCard.onclick = () => showScreen('courses');
        continueProgress.style.width = '0%';
      }
    }
    
    const achievements = document.getElementById('achievements');
    if (achievements) {
      const badges = achievements.querySelectorAll('div > div:first-child');
      if (completedLessonsCount >= 1 && badges[0]) badges[0].classList.remove('opacity-30');
      if (coursesFinishedList.length >= 1 && badges[1]) badges[1].classList.remove('opacity-30');
      if (certificatesCount >= 1 && badges[2]) badges[2].classList.remove('opacity-30');
      if (certificatesCount >= 3 && badges[3]) badges[3].classList.remove('opacity-30');
    }
  }
  async function logout() {
    const formData = new FormData();
    formData.append('action', 'logout');
    await fetch('api/auth.php', { method: 'POST', body: formData });
    location.reload(); // Recarrega para voltar √† tela de login
}
async function checkSession() {
    const formData = new FormData();
    formData.append('action', 'check_session');
    
    const res = await fetch('api/auth.php', { method: 'POST', body: formData });
    const data = await res.json();
    
    if (data.logged_in) {
        currentUser = data.user;
        document.getElementById('screen-auth').classList.add('hidden');
        updateProfileUI();
        loadBookmarks(); // Carregar bookmarks do banco se implementado
    } else {
        document.getElementById('screen-auth').classList.remove('hidden');
    }
}

// 2. Fun√ß√µes de Login/Registro
function toggleAuthMode() {
    document.getElementById('login-form').classList.toggle('hidden');
    document.getElementById('register-form').classList.toggle('hidden');
}

async function handleLogin(e) {
    e.preventDefault();
    const formData = new FormData(e.target);
    formData.append('action', 'login');
    
    const res = await fetch('api/auth.php', { method: 'POST', body: formData });
    const data = await res.json();
    
    if (data.success) {
        currentUser = data.user;
        document.getElementById('screen-auth').classList.add('hidden');
        updateProfileUI();
        showToast('Login realizado com sucesso!');
    } else {
        showToast(data.message || 'Erro ao entrar');
    }
}

async function handleRegister(e) {
    e.preventDefault();
    const formData = new FormData(e.target);
    formData.append('action', 'register');
    
    const res = await fetch('api/auth.php', { method: 'POST', body: formData });
    const data = await res.json();
    
    if (data.success) {
        showToast('Conta criada! Fa√ßa login.');
        toggleAuthMode();
    } else {
        showToast(data.message);
    }
}

// 3. Atualizar UI do Perfil com Dados Reais
function updateProfileUI() {
    if (!currentUser) return;
    
    // Atualiza nome e data no cabe√ßalho ou perfil
    const profileName = document.querySelector('#screen-profile h2');
    if(profileName) profileName.textContent = currentUser.full_name;
    
    // Atualiza imagem de perfil se existir
    if (currentUser.profile_pic && currentUser.profile_pic !== 'default_avatar.png') {
        const imgPath = `uploads/${currentUser.profile_pic}`;
        // Encontre as tags <img> de perfil e atualize o src
        document.querySelectorAll('.profile-img-display').forEach(img => img.src = imgPath);
    }
    
    // Preenche o formul√°rio de edi√ß√£o (crie esse form no HTML do perfil)
    document.getElementById('edit-name').value = currentUser.full_name || '';
    document.getElementById('edit-phone').value = currentUser.phone || '';
    document.getElementById('edit-bi').value = currentUser.bi_number || '';
    document.getElementById('edit-address').value = currentUser.address || '';
}

// 4. Salvar Perfil Editado
async function saveProfile() {
    const formData = new FormData(document.getElementById('profile-edit-form'));
    
    const res = await fetch('api/profile.php', { method: 'POST', body: formData });
    const data = await res.json();
    
    if (data.success) {
        currentUser = data.user; // Atualiza dados locais
        updateProfileUI();
        showToast('Perfil atualizado com sucesso!');
    } else {
        showToast('Erro ao atualizar perfil.');
    }
}
function switchLanguage(targetUrl) {
  // Se n√£o passar URL, define um padr√£o (ex: vers√£o em ingl√™s)
  if (!targetUrl) targetUrl = 'index_ts.html'; 

  const overlay = document.getElementById('lang-transition-overlay');
  const langText = document.getElementById('lang-text');
  
  // 1. Ativa o Overlay
  overlay.classList.add('lang-active');
  
  // 2. Simula o processo de tradu√ß√£o (troca o texto no meio da anima√ß√£o)
  setTimeout(() => {
    langText.classList.add('text-switch-anim');
    langText.textContent = "Translating..."; // Texto em ingl√™s
  }, 800);

  // 3. Redireciona ap√≥s a anima√ß√£o estar completa
  setTimeout(() => {
    window.location.href = "index_ts.html";
  }, 2000); // 2 segundos total de efeito "uau"
}
   async function generatePDF(courseTitle, finalScore) {
if (finalScore < 70) {
  showToast('M√©dia insuficiente para gerar certificado.');
  return;
}

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({
        orientation: 'landscape',
        unit: 'mm',
        format: 'a4'
    });

    const pageWidth = doc.internal.pageSize.getWidth();
    const pageHeight = doc.internal.pageSize.getHeight();

    // 1. Fundo e Bordas Profissionais
    doc.setFillColor(255, 253, 245); 
    doc.rect(0, 0, pageWidth, pageHeight, 'F');
    
    // Moldura Dourada
    doc.setDrawColor(212, 175, 55); 
    doc.setLineWidth(1.5);
    doc.rect(10, 10, pageWidth - 20, pageHeight - 20); 
    doc.setLineWidth(0.5);
    doc.rect(12, 12, pageWidth - 24, pageHeight - 24);

    // 2. LOGOTIPO CENTRALIZADO
    const caminhoLogo = "icon2.png"; // <-- INDIQUE O CAMINHO AQUI
    try {
        // addImage(caminho, tipo, x, y, largura, altura)
        doc.addImage(caminhoLogo, 'PNG', (pageWidth / 2) - 25, 20, 50, 50);
    } catch (e) {
        console.error("Erro ao carregar logotipo:", e);
    }

    // 3. TEXTOS DO CERTIFICADO
    doc.setTextColor(80, 50, 20);
    doc.setFont("times", "bold");
    doc.setFontSize(45);
    doc.text("DIPLOMA", pageWidth / 2, 85, { align: "center" });

    doc.setFontSize(18);
    doc.setFont("helvetica", "italic");
    doc.text("Certificamos para os devidos fins que o aluno(a) concluiu o curso:", pageWidth / 2, 100, { align: "center" });

    doc.setFontSize(32);
    doc.setTextColor(184, 134, 11); 
    doc.text(courseTitle.toUpperCase(), pageWidth / 2, 120, { align: "center" });

    doc.setFontSize(16);
    doc.setTextColor(80, 50, 20);
    doc.text("Ministrado pela Academia B√≠blica com aproveitamento e dedica√ß√£o.", pageWidth / 2, 135, { align: "center" });
    doc.setFontSize(18);
doc.setTextColor(80, 50, 20);
doc.text(
  `Aproveitamento Final: ${finalScore}%`,
  pageWidth / 2,
  145,
  { align: "center" }
);


    // 4. SELO DE QUALIDADE (SUBSTITUI√á√ÉO DA IMAGEM)
    const caminhoSelo = "selo.png"; // <-- INDIQUE O CAMINHO DO SELO AQUI
    try {
        // Posicionado no canto inferior direito de forma profissional
        doc.addImage(caminhoSelo, 'PNG', pageWidth - 60, pageHeight - 65, 40, 40);
    } catch (e) {
        console.error("Erro ao carregar imagem do selo:", e);
        // Caso a imagem falhe, um fallback elegante
        doc.setDrawColor(212, 175, 55);
        doc.circle(pageWidth - 40, pageHeight - 45, 15, 'S');
    }

    // 5. RODAP√â E DATA
    const dataAtual = new Date().toLocaleDateString('pt-BR');
    doc.setFontSize(12);
    doc.setFont("helvetica", "normal");
    doc.text(`Data de Emiss√£o: ${dataAtual}`, 30, pageHeight - 30);
    
    // Linha de Assinatura
    doc.setDrawColor(120, 53, 15);
    doc.line(pageWidth / 2 - 30, pageHeight - 35, pageWidth / 2 + 30, pageHeight - 35);
    doc.text("Assinatura da Dire√ß√£o", pageWidth / 2, pageHeight - 30, { align: "center" });

    // Finalizar e salvar
    const pdfBlob = doc.output('blob'); // Gera o arquivo em mem√≥ria
        
    // Envia para o servidor
    const formData = new FormData();
    formData.append('pdf', pdfBlob, `certificado.pdf`);
    formData.append('course_title', courseTitle);
    
    showToast('Gerando e salvando certificado...');
    
    try {
        const res = await fetch('api/upload_pdf.php', { method: 'POST', body: formData });
        const data = await res.json();
        
        if (data.success) {
            showToast('Certificado salvo na sua conta! üèÜ');
            // Tamb√©m baixa localmente para o usu√°rio ver
            doc.save(`Certificado_${courseTitle}.pdf`);
        }
    } catch (err) {
        console.error(err);
        // Fallback: baixa localmente mesmo se falhar o upload
        doc.save(`Certificado_${courseTitle}.pdf`);
    }
}
  </script>
</body>
</html> 